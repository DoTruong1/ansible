# tasks file for web
- name: check docker is active
  service:
    name: docker
    state: started
    enabled: yes

- name: Get infos on container
  community.docker.docker_container_info:
    name: "web-{{ env }}"
  register: docker_info

- name: Stop a container
  docker_container:
    name: "web-{{ env }}"
    state: stopped
  when: docker_info.exists

- name: remove the container
  docker_container:
    name: "web-{{ env }}"
    state: absent
  when: docker_info.exists

- name: Deploy web service
  docker_container:
    name: "web-{{ env }}"
    image: "{{ web[env].image }}:{{ web[env].tag}}"
    ports:
      - "{{ web[env].port }}:80"
    env:
      APP_API_URL: "{{ web[env].backend_env_url }}"
